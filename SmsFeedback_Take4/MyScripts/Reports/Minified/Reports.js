"use strict";window.app=window.app||{};_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{%([\s\S]+?)%\}/g,escape:/\{%-([\s\S]+?)%\}/g};var ReportModel=Backbone.Model.extend({menuId:1,title:"Total sms report",scope:"Global",sections:[{identifier:"PrimaryChartArea",visibility:true,resources:[{name:"Get total no of sms report",source:"/Reports/getTotalNoOfSms"}]},{identifier:"InfoBox",visibility:true,resources:[{name:"Total no of sms",source:"Reports/getNoOfSms"}]},{identifier:"AdditionalChartArea",visibility:false,resources:[]}]});var ReportsContentArea=Backbone.View.extend({el:$("#rightColumn"),initialize:function(){_.bindAll(this,"render","setupEnvironment","updateReport");this.render()},render:function(){var a=_.template($("#report-template").html(),this.model.toJSON());$(this.el).html(a);$("#reportScope").html(" :: "+window.app.currentWorkingPointFriendlyName);this.setupEnvironment();$(document).trigger("resize")},setupEnvironment:function(){this.transition=new Transition();this.transition.startTransition();window.app.areas=[];for(var b=0;b<this.model.get("sections").length;++b){if(this.model.get("sections")[b].visibility&&(this.model.get("sections")[b].identifier==="PrimaryChartArea")){window.app.firstArea=new FirstArea(this.model.get("sections")[b].resources[0].source,"day",this.model.get("sections")[b].resources[0].options);window.app.firstArea.drawArea();window.app.areas.push(window.app.firstArea)}else{if(this.model.get("sections")[b].visibility&&(this.model.get("sections")[b].identifier=="SecondaryChartArea")){window.app.thirdArea=new ThirdArea(this.model.get("sections")[b].resources[0].source);window.app.thirdArea.drawArea();window.app.areas.push(window.app.thirdArea)}else{if(this.model.get("sections")[b].visibility&&(this.model.get("sections")[b].identifier==="InfoBox")){window.app.secondArea=new SecondArea(this.model.get("sections")[b].resources);window.app.secondArea.drawArea();window.app.areas.push(window.app.secondArea)}}}}$("#from").datepicker({dateFormat:"dd/mm/yy",defaultDate:"+1w",changeMonth:true,numberOfMonths:3,onSelect:function(g){$("#to").datepicker("option","minDate",g);var f=g.substring(0,2);var i=g.substring(3,5)-1;var h=g.substring(6,g.length);window.app.newStartDate=new Date(h,i,f);if(window.app.newStartDate!=window.app.startDate){window.app.startDate=window.app.newStartDate;window.app.endDate=window.app.newEndDate;$(document).trigger("intervalChanged")}}});$("#to").datepicker({dateFormat:"dd/mm/yy",defaultDate:"+1w",changeMonth:true,numberOfMonths:3,onSelect:function(g){$("#from").datepicker("option","maxDate",g);var f=g.substring(0,2);var i=g.substring(3,5)-1;var h=g.substring(6,g.length);window.app.newEndDate=new Date(h,i,f);if(window.app.newEndDate!=window.app.endDate){window.app.startDate=window.app.newStartDate;window.app.endDate=window.app.newEndDate;$(document).trigger("intervalChanged")}}});var a=((window.app.startDate.getDate()<10)?"0"+window.app.startDate.getDate():window.app.startDate.getDate())+"-"+(((window.app.startDate.getMonth()+1)<10)?"0"+(window.app.startDate.getMonth()+1):window.app.startDate.getMonth()+1)+"-"+window.app.startDate.getFullYear();var c=((window.app.endDate.getDate()<10)?"0"+window.app.endDate.getDate():window.app.endDate.getDate())+"-"+(((window.app.endDate.getMonth()+1)<10)?"0"+(window.app.endDate.getMonth()+1):window.app.endDate.getMonth()+1)+"-"+window.app.endDate.getFullYear();$("#to").datepicker("option","minDate",a);$("#from").datepicker("option","maxDate",c);var e=$("#from").val();var d=$("#to").val();$("#from").datepicker("option",$.datepicker.regional[window.app.calendarCulture]);$("#to").datepicker("option",$.datepicker.regional[window.app.calendarCulture]);$("#from").val(e);$("#to").val(d);$(".radioOption").change(function(){$(this).parents("#granularitySelector").find(".active").removeClass("active");$(this).parents(".radioBtnWrapper").addClass("active");window.app.firstArea.setGranularity($(this).val());window.app.firstArea.drawArea()});this.transition.endTransition()},updateReport:function(){$("#reportScope").html(" :: "+window.app.currentWorkingPointFriendlyName);window.app.firstArea.drawArea();window.app.secondArea.drawArea();window.app.thirdArea.drawArea()}});var Transition=function(){var a={lines:13,length:7,width:4,radius:10,rotate:0,color:"#fff",speed:1,trail:60,shadow:true,hwaccel:false,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};var c=new Spinner(a);var b=document.getElementById("chartArea");this.startTransition=function(){c.spin(b);$("#overlay").show()};this.endTransition=function(){c.stop();$("#overlay").hide()}};var ReportsArea=function(){var b=this;var c={};var d=new window.app.MenuView({el:$("#leftColumn"),eventToTriggerOnSelect:"switchReport",menuCollection:new window.app.MenuCollection({url:"/Reports/getReportsMenuItems"}),afterInitializeFunction:function(){$(".liItem2").addClass("menuItemSelected");$("ul.item1").css("display","block")}});var a;$(document).bind("workingPointChanged",function(f,e){b.changeWorkingPoint(e)});$(document).bind("intervalChanged",function(e){b.changeReportingInterval()});$(document).bind("switchReport",function(e,f){b.loadReport(f)});this.redrawContent=function(){a.render()};this.changeWorkingPoint=function(e){window.app.currentWorkingPoint=e;a.updateReport()};this.changeReportingInterval=function(){a.updateReport()};this.displayReport=function(e){a=new ReportsContentArea({model:e,el:$("#rightColumn")})};this.loadReport=function(e){if(c[e]===undefined){$.getJSON("Reports/getReportById",{reportId:e},function(g){var f=new ReportModel(g);c[e]=f;b.displayReport(c[e])})}else{b.displayReport(c[e])}};this.loadWorkingPoints=function(){$.getJSON(window.app.domainName+"/Messages/WorkingPointsPerUser",{},function(g){var e="<option value='Global'>Global</option>";for(var f=0;f<g.length;++f){e+="<option value='"+g[f].TelNumber+"'>"+g[f].Name+"</option>"}$("#workingPointSelector").append(e);$("#workingPointSelector").val("Global");$("#workingPointSelector").change(function(){window.app.currentWorkingPointFriendlyName=$("#workingPointSelector").children("option").filter(":selected").text();$(document).trigger("workingPointChanged",$(this).val())})})};this.loadReport(2);$("#overlay").hide();this.loadWorkingPoints()};