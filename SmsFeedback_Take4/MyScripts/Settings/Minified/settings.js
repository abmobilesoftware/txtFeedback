window.app=window.app||{};window.settings=window.settings||{};function setupForm(c,a,b){$("#rightColumn").html(c);$("#rightColumn form").submit(function(){return false});$(a).unbind("click");$(a).bind("click",b)}window.app.changePassword=function(){$.ajax({url:"Settings/GetChangePasswordForm",data:$("#rightColumn form").serialize(),type:"post",cache:true,dataType:"html",success:function(a){$("#rightColumn").html(a);setupForm(a,"#btnChangePassword",window.app.changePassword);resizeTriggered()},error:function(a,c,b){$("#rightColumn").html(a)}})};window.settings.ConfigurePassword=function(){$.ajax({url:"Settings/GetChangePasswordForm",cache:false,success:function(a){setupForm(a,"#btnChangePassword",window.app.changePassword)}})};window.app.getDataForWorkingPoints=function(){var a=[];$("#rightColumn table").find('tr[name="dataRow"]').each(function(){var b={TelNumber:$('span[name="TelNumber"]',this).text(),ShortID:$('span[name="ShortID"]',this).text(),MaxNrOfSmsToSendPerMonth:$('span[name="MaxNrOfSmsToSendPerMonth"]',this).text(),Name:trim($('input[name="Name"]',this).val()),Description:trim($('input[name="Description"]',this).val()),NrOfSentSmsThisMonth:15,WelcomeMessage:trim($('textarea[name="WelcomeMessage"]',this).val())};a.push(b)});return a};window.app.localForSetting={};window.app.localForSetting.setTooltipsOnHeaders=function(){$("th").each(function(){$(this).qtip({content:$(this).attr("tooltiptitle"),position:{corner:{target:"topLeft",tooltip:"bottomLeft"}},style:"dark"})})};window.app.saveWorkingPoints=function(b){b.preventDefault();var a=window.app.getDataForWorkingPoints();$.ajax({url:"WorkingPoints/WorkingPointsInfo",data:$.toJSON(a),type:"post",cache:false,dataType:"html",contentType:"application/json; charset=utf-8",success:function(c){setupForm(c,"#btnSaveWorkingPoints",window.app.saveWorkingPoints);window.app.localForSetting.setTooltipsOnHeaders();resizeTriggered()},error:function(c,e,d){$("#rightColumn").html(c)}})};window.settings.ConfigureWorkingPoints=function(){$.ajax({url:"WorkingPoints/WorkingPointsInfo",cache:false,success:function(a){setupForm(a,"#btnSaveWorkingPoints",window.app.saveWorkingPoints);window.app.localForSetting.setTooltipsOnHeaders();resizeTriggered()},error:function(a,c,b){$("#rightColumn").html(a)}})};window.app.updateGUIWhenBillingInfoArrived=function(d){$("#rightColumn").html(d);$("#WarningLimit").attr("readonly",true);var e=parseFloat($("#SpendingLimit").val());var c=0;var b=e/100;var a=parseFloat($("#WarningLimit").val());$("#slider-range-max").slider({range:"max",min:c,max:e,step:b,value:a,slide:function(f,g){$("#WarningLimit").val(g.value)}});$("#saveBillingInfo").unbind("click");$("#saveBillingInfo").bind("click",window.app.saveBillingInfo);window.app.localForSetting.setTooltipsOnHeaders();resizeTriggered()};window.settings.ConfigureCompanyBillingInfo=function(){$.ajax({url:"Settings/CompanyBillingInfo",cache:false,success:function(a){window.app.updateGUIWhenBillingInfoArrived(a)},error:function(a,c,b){$("#rightColumn").html(a)}})};window.app.saveBillingInfo=function(b){b.preventDefault();var a=$("#rightColumn form").serialize();$.ajax({url:"Settings/CompanyBillingInfo",data:a,type:"post",cache:false,dataType:"html",success:function(c){window.app.updateGUIWhenBillingInfoArrived(c)},error:function(c,e,d){$("#rightColumn").html(c)}})};window.app.leftSideMenus={};window.app.SettingsArea=function(){var a=new window.app.MenuView({el:$("#leftColumn"),eventToTriggerOnSelect:"switchSetting",menuCollection:new window.app.MenuCollection({url:"/Settings/GetMenuItems"}),afterInitializeFunction:function(b){_(b.models).each(function(d){if(d.get("parent")!==0){window.app.leftSideMenus[d.get("FriendlyName")]={id:d.get("itemId"),action:d.get("Action")}}});var c=Backbone.Router.extend({routes:{"":"defaultCall",":menu":"goToMenu"},goToMenu:function(e){var g=window.app.leftSideMenus[e];if(g!==undefined){var f=window.settings[g.action];if(typeof f==="function"){f();var i=".liItem"+g.id;if(!$(i).hasClass("menuItemSelected")){$(i).parents(".collapsibleList").find(".menuItemSelected").removeClass("menuItemSelected");$(i).addClass("menuItemSelected");var h=Math.floor(g.id/10)*10;var d="ul.item"+h;$(d).css("display","block")}}}else{this.defaultCall()}},defaultCall:function(){$(".liItem21").addClass("menuItemSelected");$("ul.item20").css("display","block");window.settings.router.navigate("/ChangePassword",{trigger:true})}});window.settings.router=new c();Backbone.history.start()}});$(document).bind("switchSetting",function(b,c){window.settings.router.navigate("/"+c.menuNavigation,{trigger:true})})};