window.app=window.app||{};window.app.workingPointsNameDictionary={};window.app.workingPointsSuffixDictionary={};window.app.WorkingPoint=Backbone.Model.extend({defaults:{TelNumber:"defaultNumber",Name:"defaultNumber",Description:"defaultDescription",CheckedStatus:true,ShortID:"defaultID",XMPPsuffix:"defaultXMPPsuffix",XMPPaddress:"defaultXmppAddress"},parse:function(b,a){window.app.workingPointsNameDictionary[b.TelNumber]=b.Name;window.app.workingPointsNameDictionary[b.ShortID]=b.Name;window.app.workingPointsSuffixDictionary[b.ShortID]=b.XMPPsuffix;b.XMPPaddress=b.ShortID+b.XMPPsuffix;return b},idAttribute:"TelNumber"});window.app.WorkingPointPool=Backbone.Collection.extend({model:window.app.WorkingPoint,url:function(){return window.app.domainName+"/WorkingPoints/WorkingPointsPerUser"},getWorkingPointXmppAddress:function(b){if(this.get(b)!==undefined){return this.get(b).get("XMPPaddress")}else{var a=this.where({ShortID:b});if(a.length===1){return a[0].get("XMPPaddress")}}return null}});window.app.nrOfCheckedWorkingPoints=0;_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{%([\s\S]+?)%\}/g,escape:/\{%-([\s\S]+?)%\}/g};window.app.WorkingPointView=Backbone.View.extend({model:window.app.WorkingPoint,tagName:"span",events:{"click .wpSelectorIcon":"selectedChanged"},initialize:function(){_.bindAll(this,"render","selectedChanged","unrender");this.model.bind("destroy",this.unrender);return this.render},render:function(){this.phoneNumberTemplate=_.template($("#phoneNumber-template").html());this.$el.html(this.phoneNumberTemplate(this.model.toJSON()));this.$el.addClass("phoneNumber");this.$el.addClass("phoneNumberSelected");var a=$("img",this.$el);setTooltipOnElement(a,a.attr("tooltiptitle"),"light");return this},unrender:function(){this.$el.remove()},selectedChanged:function(){if((window.app.nrOfCheckedWorkingPoints>=2)||!this.model.attributes.CheckedStatus){this.model.set("CheckedStatus",!this.model.get("CheckedStatus"));var a=$("img",this.$el);if(this.model.get("CheckedStatus")===true){this.$el.removeClass("phoneNumberUnselected");this.$el.addClass("phoneNumberSelected");setCheckboxState(a,true)}else{this.$el.removeClass("phoneNumberSelected");this.$el.addClass("phoneNumberUnselected");setCheckboxState(a,false)}}}});window.app.defaultWpAreaOptions={checkedPhoneNumbersArray:[]};window.app.WorkingPointsArea=function(){var a=this;$.extend(this,window.app.defaultWpAreaOptions);var b={lines:13,length:7,width:4,radius:10,rotate:0,color:"#fff",speed:1,trail:60,shadow:true,hwaccel:false,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};var d=new Spinner(b);var c=Backbone.View.extend({el:$("#leftColumn"),initialize:function(){_.bindAll(this,"render","appendWorkingPoint","getWorkingPoints","triggerFilteringOnCheckedStatusChange");this.phoneNumbersPool=new window.app.WorkingPointPool();this.phoneNumbersPool.bind("add",this.appendWorkingPoint,this);this.phoneNumbersPool.bind("reset",this.render)},getWorkingPoints:function(e){window.app.nrOfCheckedWorkingPoints=0;var f=document.getElementById("leftColumn");d.spin(f);this.phoneNumbersPool.fetch({success:function(){d.stop();e()}})},render:function(){var e=this;this.phoneNumbersPool.each(function(f){e.appendWorkingPoint(f)})},appendWorkingPoint:function(g){var f=this;g.on("change",function(h){f.triggerFilteringOnCheckedStatusChange(h)});var e=new window.app.WorkingPointView({model:g});window.app.nrOfCheckedWorkingPoints++;$(this.el).append(e.render().el)},triggerFilteringOnCheckedStatusChange:function(e){if(e.get("CheckedStatus")===true){window.app.nrOfCheckedWorkingPoints++}else{window.app.nrOfCheckedWorkingPoints--}a.checkedPhoneNumbersArray=[];_.each(this.phoneNumbersPool.models,function(f){if(f.get("CheckedStatus")===true){a.checkedPhoneNumbersArray.push(f.get("TelNumber"))}});$(document).trigger("refreshConversationList")}});a.wpPoolView=new c()};