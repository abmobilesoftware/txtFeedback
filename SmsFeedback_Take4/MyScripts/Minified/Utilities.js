window.app=window.app||{};function showStatus(c,d,a,b){}window.app.domainName="";window.app.lastAjaxCall={settings:null,jqXHR:null};window.app.loginSummaryUrl="/Account/LogOnSummary";window.app.loginUrl="/Account/LogOn";window.app.firstCall=true;window.app.requestIndex=0;function trim(a){a=a.replace(/(^\s*)|(\s*$)/gi,"");a=a.replace(/[ ]{2,}/gi," ");a=a.replace(/\n /,"\n");return a}var cConversationIdNumbersSeparator="-";function getFromToFromConversation(b){var a=b.split(cConversationIdNumbersSeparator);return a}function cleanupPhoneNumber(c){var b=new Array("00","\\+");var a=new RegExp("^("+b.join("|")+")|@.+$","g");c=c.replace(a,"");return c}function buildConversationID(b,a){return cleanupPhoneNumber(b)+cConversationIdNumbersSeparator+cleanupPhoneNumber(a)}function comparePhoneNumbers(b,a){return cleanupPhoneNumber(b)===cleanupPhoneNumber(a)}function endsWith(b,a){return b.indexOf(a,b.length-a.length)!==-1}function isWorkingPoint(b,a){if(a===undefined||a==="null"){return false}return endsWith(b,a)}function setTooltipOnElement(b,c,a){b.qtip({content:{text:c},style:a})}function setCheckboxState(b,a){if(a===true){b.attr("src",window.app.domainName+"/Content/images/check-white.svg");b.removeClass("deletePhoneNumberIconUnselected");b.addClass("deletePhoneNumberIconSelected")}else{b.attr("src",window.app.domainName+"/Content/images/transparent.gif");b.removeClass("deletePhoneNumberIconSelected");b.addClass("deletePhoneNumberIconUnselected")}}window.app.updateNrOfUnreadConversations=function(a){$.getJSON(window.app.domainName+"/Conversations/NrOfUnreadConversations",{performUpdateBefore:a},function(b){if(b!==null){window.app.setNrOfUnreadConversationOnTab(b.Value)}})};window.app.canSendSmS=true;window.app.checkSmsSubscriptionStatus=function(){$.getJSON("Messages/SMSSSubscriptionStatus",{},function(a){if(a.SpendingLimitReached){window.app.canSendSmS=false;window.app.NotifyArea.show(a.SpendingLimitReachedMessage,function(){window.location.href="mailto:contact@txtfeedback.net?subject=Increase spending limit or Buy Credit"},true)}else{if(a.WarningLimitReached){window.app.NotifyArea.show(a.WarningLimitReachedMessage,function(){window.location.href="mailto:contact@txtfeedback.net?subject=Ensure that enough credit is still available"},false)}}})};window.app.Payload=Backbone.Model.extend({defaults:{SpendingLimitReached:false,WarningLimitReached:false,MessageID:0,MessageSent:false,Reason:"",}});function payloadReceived(c,a){var d=new window.app.Payload(jQuery.parseJSON(c));if(!d.get("MessageSent")){var e=$("#messageNotSentReasonUnknown").val();if(d.get("SpendingLimitReached")){window.app.canSendSmS=false;e=$("#messageNotSentInsufficientCredits").val();window.app.NotifyArea.show(e,function(){window.location.href="mailto:contact@txtfeedback.net?subject=Increase spending limit or Buy Credit"},true)}else{window.app.NotifyArea.show(e,function(){window.location.href="mailto:contact@txtfeedback.net?subject=Unable to deliver message with id "+d.get("MessageID")},true)}}else{if(d.get("SpendingLimitReached")){var b=$("#messageSentSpendingLimitReached").val();window.app.NotifyArea.show(b,function(){window.location.href="mailto:contact@txtfeedback.net?subject=Increase spending limit or Buy Credit"},false)}$(document).trigger("clientAcknowledge",{message:getMessage(a)})}}window.app.resizeInProgress=false;function resizeTriggered(){if(!window.app.resizeInProgress){window.app.resizeInProgress=true;var e=$(".headerArea").outerHeight();var i=window.innerHeight;var f=$("header").outerHeight();var h=i-f;var a=parseInt($("#rightColumn").css("margin-top"),10);var d=parseInt($("#rightColumn").css("margin-bottom"),10);var c=h-e-a-d;$("#rightColumn").height("auto");var b=$("#rightColumn").outerHeight();var g=$(".container_12");if(c>b){g.height(h);$("#rightColumn").height(c);$("#leftColumn").height(h-e);$("#scrollableconversations").height(c);$("#scrollablemessagebox").height(c-135)}else{g.height(b+e+a+d);$("#leftColumn").height(b+a+d);$("#scrollableconversations").height(b);$("#scrollablemessagebox").height(b-135)}$(".page").height(f+g.height());$("body").height(f+g.height());$("html").height(f+g.height());window.app.resizeInProgress=false}}$(function(){if(!window.addEventListener){window.attachEvent("resize",resizeTriggered)}else{window.addEventListener("resize",resizeTriggered,false);window.addEventListener("smsPayloadReceived",payloadReceived,false)}$(document).bind("smsPayloadReceived",function(a,b){payloadReceived(b.content,b.messageId)})});$(function(){$(window).unload(function(){var a=new Persist.Store("SmsFeedback");a.set("msgTabcountValue",$("#msgTabcount").text())})});$(function(){var a=new Persist.Store("SmsFeedback");a.get("msgTabcountValue",function(b,c){if(b){$("#msgTabcount").text(c)}})});$(function(){$.ajaxSetup({cache:false})});$(function(){$(document).ready(function(){$(document).ajaxError(function(b,c,a){if(c.status===401){window.location.href=window.app.loginUrl}})})});window.app.logErrorOnServer=function logError(a){$.ajax({type:"POST",url:"ErrorLog/LogError",data:JSON.stringify({errorMsg:a,context:navigator.userAgent}),contentType:"application/json; charset=utf-8"})};window.app.logDebugOnServer=function logError(a){$.ajax({type:"POST",url:"ErrorLog/LogDebug",data:JSON.stringify({errorMsg:a,context:navigator.userAgent}),contentType:"application/json; charset=utf-8"})};$(function(){window.onerror=function(d,c,a){var b=c+": "+a+"\n"+d;window.app.logErrorOnServer(b)}});$(function(){var a=$("#msgTabcount");setTooltipOnElement(a,a.attr("tooltiptitle"),"light")});window.app.NotifyAreaModel=Backbone.Model.extend({defaults:{Message:"You are approaching your spending limit for this month - make sure your limit or credit are high enough for normal operation",SolveAction:function(){window.location.href="mailto:contact@txtfeedback.net"},Visible:false,IsError:true}});_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{%([\s\S]+?)%\}/g,escape:/\{%-([\s\S]+?)%\}/g};window.app.NotifyAreaView=Backbone.View.extend({model:window.app.NotifyAreaModel,tagName:"div",events:{"click #takeAction":"callAction","click #notificationAck":"hide",},initialize:function(){this.template=_.template($("#notifyAreaTemplate").html());_.bindAll(this,"render","callAction","hide");this.model.bind("change",this.render);return this.render},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.addClass("notificationArea");if(!this.model.get("Visible")){this.$el.hide()}return this},callAction:function(){var a=this.model.get("SolveAction");a()},show:function(b,c,a){this.model.set("Visible",true);this.model.set("Message",b);this.model.set("IsError",a);this.model.set("SolveAction",c);this.$el.show();resizeTriggered()},hide:function(){this.model.set("Visible",false);this.$el.hide();resizeTriggered()}});$(function(){var a=new window.app.NotifyAreaModel();window.app.NotifyArea=new window.app.NotifyAreaView({model:a});$("header").prepend(window.app.NotifyArea.render().$el);window.app.checkSmsSubscriptionStatus()});